!function(){var n=function(n,e,t){var o="http://api.openweathermap.org/data/2.5/weather?id="+n.id,a=new XMLHttpRequest;a.open("GET",o,!0),a.onload=function(){this.status>=200&&this.status<400?e(this):t(this)},a.onerror=function(){t(this)},a.send()},e=function(n){var e,t=n.weather[0].icon.substr(0,2)+".png";try{e={19:"icons/favicons19/"+t,38:"icons/favicons38/"+t}}catch(o){e={19:"icons/favicons19/02.png",38:"icons/favicons38/02.png"}}chrome.browserAction.setIcon({path:e})},t=function(){src={19:"icons/favicons19/02.png",38:"icons/favicons38/02.png"},chrome.browserAction.setIcon({path:src})},o=function(n){chrome.storage.sync.get("loc",function(e){e=e.loc&&JSON.parse(e.loc);var t={id:e&&e.id||6176823,name:e&&e.name||"waterloo"};n(t)})},a=function(){console.log("updating!"),o(function(e){n(e,function(n){var e=JSON.parse(n.response);e.setAt=Date.now(),chrome.storage.local.set({currentWeatherData:JSON.stringify(e)})},t)})},r=function(){chrome.alarms.create("updateIcon",{periodInMinutes:60}),chrome.alarms.onAlarm.addListener(a),a()};chrome.runtime.onInstalled.addListener(r),chrome.runtime.onStartup.addListener(r),chrome.storage.onChanged.addListener(function(n,t){"local"==t&&"currentWeatherData"in n&&(console.log("location changed!"),n.currentWeatherData.newValue&&(data=JSON.parse(n.currentWeatherData.newValue),e(data),chrome.alarms.create("updateIcon",{periodInMinutes:60})))})}();