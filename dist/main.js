!function(){var t=function(t,e,a){var r=document.createElement(t);for(var n in e)r.setAttribute(n,e[n]);return r.innerHTML=a||null,r},e=function(t,e,a,r){var n=new XMLHttpRequest;n.open(e,t,!0),n.onload=function(){this.status>=200&&this.status<400?a(this):r(this)},n.onerror=function(){r(this)},n.send()},a=function(e){this.attrs=e,this.render=function(){var e=t("div",{"class":"current"}),a=t("img",{"class":"current-img",src:this.attrs.img,alt:"icon"}),r=t("div",{"class":"weather"});return r.appendChild(t("span",{},this.attrs.temp+"&deg")),r.appendChild(t("span",{},this.attrs.desc)),e.appendChild(a),e.appendChild(r),e}},r=function(e){this.attrs=e,this.render=function(){var e=t("div",{"class":"period"});return e.appendChild(t("span",{"class":"time"},this.attrs.time)),e.appendChild(t("img",{src:this.attrs.img,alt:"icon"})),e.appendChild(t("span",{"class":"temp"},this.attrs.temp+"&deg")),e.appendChild(t("span",{"class":"precip"},this.attrs.precip+"mm")),e}},n=function(e){this.attrs=e,this.render=function(){for(var e=t("div",{"class":"today"}),a=new r,n=this.attrs.today.length,s=0;n>s;s++)a.attrs=this.attrs.today[s],e.appendChild(a.render());return e}},s=function(e){this.attrs=e,this.render=function(){var e=t("div",{"class":"weather"},'<span class="temp">'+this.attrs.temp+'&deg</span><span class="description">'+this.attrs.desc+"</span>"),a=t("div",{"class":"date"},'<p class="weekday">'+this.attrs.weekday+'</p><p class="month">'+this.attrs.month+"</p>"),r=t("div",{"class":"day"});return r.appendChild(t("img",{src:this.attrs.img,alt:"icon"})),r.appendChild(e),r.appendChild(a),r}},i=function(e){this.attrs=e,this.render=function(){for(var e=t("div",{"class":"forecast"}),a=new s,r=this.attrs.days.length,n=0;r>n;n++)a.attrs=this.attrs.days[n],e.appendChild(a.render());return e}},o=function(e,r,s){var o=new a(e),d=new n({today:r}),c=new i({days:s});document.body.appendChild(o.render()),document.body.appendChild(t("hr")),document.body.appendChild(d.render()),document.body.appendChild(t("hr")),document.body.appendChild(c.render())},d=function(t){console.log(t);var e,a,r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["January","February","March","April","May","June","July","August","September","October","November","December"],s={img:"icons/"+t[0].weather[0].icon.substr(0,2)+".png",temp:Math.round(t[0].main.temp-273.15),desc:t[0].weather[0].main},i=[];for(e=0;5>e;e++){a=new Date(1e3*t[1].list[e].dt);var d="0"+a.getHours();d=d.substr(d.length-2);var c="0"+a.getMinutes();c=c.substr(c.length-2);var h=0;t[1].list[e].rain?h=t[1].list[e].rain["3h"]:t[1].list[e].snow&&(h=t[1].list[e].snow["3h"]),i.push({img:"icons/"+t[1].list[e].weather[0].icon.substr(0,2)+".png",temp:Math.round(t[1].list[e].main.temp-273.15),precip:h,time:d+":"+c})}var p=[];for(e=0;5>e;e++)a=new Date(1e3*t[2].list[e].dt),p.push({img:"icons/"+t[2].list[e].weather[0].icon.substr(0,2)+".png",temp:Math.round(t[2].list[e].temp.max-273.15),desc:t[2].list[e].weather[0].main,weekday:r[a.getDay()],month:n[a.getMonth()]+" "+a.getDate()});o(s,i,p)},c=function(t){for(var e=t.length,a=0;e>a;a++)if(!t[a])return!1;return!0},h=function(){var t=[null,null,null];chrome.storage.local.get("currentWeatherData",function(a){a.currentWeatherData?t[0]=JSON.parse(a.currentWeatherData):e("http://api.openweathermap.org/data/2.5/weather?q=waterloo,ca","GET",function(e){chrome.storage.local.set({currentWeatherData:e.response}),t[0]=JSON.parse(currentWeatherData)},function(){console.log("error")}),c(t)&&d(t)}),chrome.storage.local.get("todayWeatherData",function(a){a.todayWeatherData?t[1]=JSON.parse(a.todayWeatherData):e("http://api.openweathermap.org/data/2.5/forecast?q=waterloo,ca","GET",function(e){chrome.storage.local.set({todayWeatherData:e.response}),t[1]=JSON.parse(e.response)},function(){console.log("error")}),c(t)&&d(t)}),chrome.storage.local.get("forecastWeatherData",function(a){a.forecastWeatherData?t[2]=JSON.parse(a.forecastWeatherData):e("http://api.openweathermap.org/data/2.5/forecast/daily?q=waterloo,ca","GET",function(e){chrome.storage.local.set({forecastWeatherData:e.response}),t[2]=JSON.parse(e.response)},function(){console.log("error")}),c(t)&&d(t)})};h()}();