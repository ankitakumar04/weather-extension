!function(){var n=function(n,o,t){var e="http://api.openweathermap.org/data/2.5/weather?id="+n.id,c=new XMLHttpRequest;c.open("GET",e,!0),c.onload=function(){this.status>=200&&this.status<400?o(this):t(this)},c.onerror=function(){t(this)},c.send()},o=function(n){var o=JSON.parse(n.response);o.setAt=Date.now(),chrome.storage.local.set({currentWeatherData:JSON.stringify(o)});var t,e=o.weather[0].icon.substr(0,2)+".png";try{t={19:"icons/favicons19/"+e,38:"icons/favicons38/"+e}}catch(c){t={19:"icons/favicons19/01.png",38:"icons/favicons38/01.png"}}chrome.browserAction.setIcon({path:t})},t=function(){src={19:"icons/favicons19/01.png",38:"icons/favicons38/01.png"},chrome.browserAction.setIcon({path:src})},e=function(n){chrome.storage.sync.get("loc",function(o){o=o.loc&&JSON.parse(o.loc);var t={id:o&&o.id||6176823,name:o&&o.name||"waterloo"};n(t)})},c=function(){console.log("updating!"),e(function(e){n(e,o,t)})},a=function(){chrome.alarms.create("updateIcon",{periodInMinutes:60}),chrome.alarms.onAlarm.addListener(c),c()};chrome.runtime.onInstalled.addListener(a),chrome.runtime.onStartup.addListener(a),chrome.storage.onChanged.addListener(function(n,o){"sync"==o&&"loc"in n&&(console.log("location changed!"),c())})}();